<!DOCTYPE html><html><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>Reusing code with require</title><meta property="og:title" content="Reusing code with require" /><meta property="og:type" content="website" /><meta name="description" content="A library is a collection of useful functions and other definitions which is stored separately to your main program." /><meta property="og:description" content="A library is a collection of useful functions and other definitions which is stored separately to your main program." /><meta property="og:image" content="https://devvie.cc/docs/cc/pack.png" /><meta property="og:site_name" content="CC: Tweaked" /><meta name="illuaminate:index" content="../index.json" /><link rel="stylesheet" href="../main.css?v=5ab962eb" type="text/css" /><!--
SPDX-FileCopyrightText: 2020 The CC: Tweaked Developers

SPDX-License-Identifier: MPL-2.0
-->

<meta name="theme-color" content="#c8d87c"></head><body><nav id="nav"><button id="nav-reveal" type="button">&#9776;</button><h1><a href=".././"><img src="../pack.png" alt="CC: Tweaked" /></a></h1><div class="nav-links"><h2 class="collapsed" tabindex="0">Globals</h2><ul><li><a href="../module/_G.html" class="sidebar-link">_G</a></li><li><a href="../module/colors.html" class="sidebar-link">colors</a></li><li><a href="../module/colours.html" class="sidebar-link">colours</a></li><li><a href="../module/commands.html" class="sidebar-link">commands</a></li><li><a href="../module/disk.html" class="sidebar-link">disk</a></li><li><a href="../module/fs.html" class="sidebar-link">fs</a></li><li><a href="../module/gps.html" class="sidebar-link">gps</a></li><li><a href="../module/help.html" class="sidebar-link">help</a></li><li><a href="../module/http.html" class="sidebar-link">http</a></li><li><a href="../module/io.html" class="sidebar-link">io</a></li><li><a href="../module/keys.html" class="sidebar-link">keys</a></li><li><a href="../module/multishell.html" class="sidebar-link">multishell</a></li><li><a href="../module/os.html" class="sidebar-link">os</a></li><li><a href="../module/paintutils.html" class="sidebar-link">paintutils</a></li><li><a href="../module/parallel.html" class="sidebar-link">parallel</a></li><li><a href="../module/peripheral.html" class="sidebar-link">peripheral</a></li><li><a href="../module/rednet.html" class="sidebar-link">rednet</a></li><li><a href="../module/settings.html" class="sidebar-link">settings</a></li><li><a href="../module/shell.html" class="sidebar-link">shell</a></li><li><a href="../module/term.html" class="sidebar-link">term</a></li><li><a href="../module/textutils.html" class="sidebar-link">textutils</a></li><li><a href="../module/turtle.html" class="sidebar-link">turtle</a></li><li><a href="../module/vector.html" class="sidebar-link">vector</a></li><li><a href="../module/window.html" class="sidebar-link">window</a></li></ul><h2 class="collapsed" tabindex="0">Modules</h2><ul><li><a href="../library/cc.audio.dfpwm.html" class="sidebar-link">cc.audio.dfpwm</a></li><li><a href="../library/cc.completion.html" class="sidebar-link">cc.completion</a></li><li><a href="../library/cc.expect.html" class="sidebar-link">cc.expect</a></li><li><a href="../library/cc.image.nft.html" class="sidebar-link">cc.image.nft</a></li><li><a href="../library/cc.pretty.html" class="sidebar-link">cc.pretty</a></li><li><a href="../library/cc.require.html" class="sidebar-link">cc.require</a></li><li><a href="../library/cc.shell.completion.html" class="sidebar-link">cc.shell.completion</a></li><li><a href="../library/cc.strings.html" class="sidebar-link">cc.strings</a></li></ul><h2 class="collapsed" tabindex="0">Events</h2><ul><li><a href="../event/alarm.html" class="sidebar-link">alarm</a></li><li><a href="../event/char.html" class="sidebar-link">char</a></li><li><a href="../event/computer_command.html" class="sidebar-link">computer_command</a></li><li><a href="../event/disk.html" class="sidebar-link">disk</a></li><li><a href="../event/disk_eject.html" class="sidebar-link">disk_eject</a></li><li><a href="../event/file_transfer.html" class="sidebar-link">file_transfer</a></li><li><a href="../event/http_check.html" class="sidebar-link">http_check</a></li><li><a href="../event/http_failure.html" class="sidebar-link">http_failure</a></li><li><a href="../event/http_success.html" class="sidebar-link">http_success</a></li><li><a href="../event/key.html" class="sidebar-link">key</a></li><li><a href="../event/key_up.html" class="sidebar-link">key_up</a></li><li><a href="../event/modem_message.html" class="sidebar-link">modem_message</a></li><li><a href="../event/monitor_resize.html" class="sidebar-link">monitor_resize</a></li><li><a href="../event/monitor_touch.html" class="sidebar-link">monitor_touch</a></li><li><a href="../event/mouse_click.html" class="sidebar-link">mouse_click</a></li><li><a href="../event/mouse_drag.html" class="sidebar-link">mouse_drag</a></li><li><a href="../event/mouse_scroll.html" class="sidebar-link">mouse_scroll</a></li><li><a href="../event/mouse_up.html" class="sidebar-link">mouse_up</a></li><li><a href="../event/paste.html" class="sidebar-link">paste</a></li><li><a href="../event/peripheral.html" class="sidebar-link">peripheral</a></li><li><a href="../event/peripheral_detach.html" class="sidebar-link">peripheral_detach</a></li><li><a href="../event/rednet_message.html" class="sidebar-link">rednet_message</a></li><li><a href="../event/redstone.html" class="sidebar-link">redstone</a></li><li><a href="../event/speaker_audio_empty.html" class="sidebar-link">speaker_audio_empty</a></li><li><a href="../event/task_complete.html" class="sidebar-link">task_complete</a></li><li><a href="../event/term_resize.html" class="sidebar-link">term_resize</a></li><li><a href="../event/terminate.html" class="sidebar-link">terminate</a></li><li><a href="../event/timer.html" class="sidebar-link">timer</a></li><li><a href="../event/turtle_inventory.html" class="sidebar-link">turtle_inventory</a></li><li><a href="../event/websocket_closed.html" class="sidebar-link">websocket_closed</a></li><li><a href="../event/websocket_failure.html" class="sidebar-link">websocket_failure</a></li><li><a href="../event/websocket_message.html" class="sidebar-link">websocket_message</a></li><li><a href="../event/websocket_success.html" class="sidebar-link">websocket_success</a></li></ul><h2 tabindex="0">Guides</h2><ul><li><a href="gps_setup.html" class="sidebar-link">Setting up GPS</a></li><li><a href="local_ips.html" class="sidebar-link">Allowing access to local IPs</a></li><li><a href="speaker_audio.html" class="sidebar-link">Playing audio with speakers</a></li><li><strong class="sidebar-link selected">Reusing code with require</strong></li></ul><h2 class="collapsed" tabindex="0">Reference</h2><ul><li><a href="../reference/feature_compat.html" class="sidebar-link">Lua 5.2/5.3 features in CC: Tweaked</a></li></ul></div></nav><div id="main"><div id="search-form" role="form"><input id="search-box" type="text" placeholder="Search..." autocomplete="off" tabindex="0"></input><div id="search-results"></div></div><section id="content"><h1>Reusing code with require</h1><!--
SPDX-FileCopyrightText: 2021 The CC: Tweaked Developers

SPDX-License-Identifier: MPL-2.0
-->
<p>A library is a collection of useful functions and other definitions which is stored separately to your main program. You
might want to create a library because you have some functions which are used in multiple programs, or just to split
your program into multiple more modular files.</p>
<p>Let's say we want to create a small library to make working with the <a href="../module/term.html" class="reference">terminal</a> a little easier. We'll provide two
functions: <code>reset</code>, which clears the terminal and sets the cursor to (1, 1), and <code>write_center</code>, which prints some text
in the middle of the screen.</p>
<p>Start off by creating a file called <code>more_term.lua</code>:</p>
<pre class="highlight" data-lua-kind="stmt" data-snippet="more_term"><span class="keyword">local</span> <span class="keyword">function</span> <span class="ident">reset</span><span class="symbol">(</span><span class="symbol">)</span>
<a href="../module/term.html">  <span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">clear</span><span class="symbol">(</span><span class="symbol">)</span>
<a href="../module/term.html">  <span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">setCursorPos</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span> <span class="number">1</span><span class="symbol">)</span>
<span class="keyword">end</span>

<span class="keyword">local</span> <span class="keyword">function</span> <span class="ident">write_center</span><span class="symbol">(</span><span class="ident">text</span><span class="symbol">)</span>
  <span class="keyword">local</span> <span class="ident">x</span><span class="symbol">,</span> <span class="ident">y</span> <span class="symbol">=</span> <a href="../module/term.html"><span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">getCursorPos</span><span class="symbol">(</span><span class="symbol">)</span>
  <span class="keyword">local</span> <span class="ident">width</span><span class="symbol">,</span> <span class="ident">height</span> <span class="symbol">=</span> <a href="../module/term.html"><span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">getSize</span><span class="symbol">(</span><span class="symbol">)</span>
<a href="../module/term.html">  <span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">setCursorPos</span><span class="symbol">(</span><span class="ident">math</span><span class="symbol">.</span><span class="symbol">floor</span><span class="symbol">(</span><span class="symbol">(</span><span class="ident">width</span> <span class="symbol">-</span> <span class="symbol">#</span><span class="ident">text</span><span class="symbol">)</span> <span class="symbol">/</span> <span class="number">2</span><span class="symbol">)</span> <span class="symbol">+</span> <span class="number">1</span><span class="symbol">,</span> <span class="ident">y</span><span class="symbol">)</span>
<a href="../module/term.html">  <span class="ident">term</span></a><span class="symbol">.</span><span class="symbol">write</span><span class="symbol">(</span><span class="ident">text</span><span class="symbol">)</span>
<span class="keyword">end</span>

<span class="keyword">return</span> <span class="symbol">{</span> <span class="ident">reset</span> <span class="symbol">=</span> <span class="ident">reset</span><span class="symbol">,</span> <span class="ident">write_center</span> <span class="symbol">=</span> <span class="ident">write_center</span> <span class="symbol">}</span><span class="symbol"></span></pre><p>Now, what's going on here? We define our two functions as one might expect, and then at the bottom return a table with
the two functions. When we require this library, this table is what is returned. With that, we can then call the
original functions. Now create a new file, with the following:</p>
<pre class="highlight" data-lua-kind="stmt" data-mount="more_term:more_term.lua"><span class="keyword">local</span> <span class="ident">more_term</span> <span class="symbol">=</span> <span class="ident">require</span><span class="symbol">(</span><span class="string">"more_term"</span><span class="symbol">)</span>
<span class="ident">more_term</span><span class="symbol">.</span><span class="symbol">reset</span><span class="symbol">(</span><span class="symbol">)</span>
<span class="ident">more_term</span><span class="symbol">.</span><span class="symbol">write_center</span><span class="symbol">(</span><span class="string">"Hello, world!"</span><span class="symbol">)</span><span class="symbol"></span></pre><p>When run, this'll clear the screen and print some text in the middle of the first line.</p>
<h2>require in depth</h2>
<p>While the previous section is a good introduction to how <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> operates, there are a couple of remaining points
which are worth mentioning for more advanced usage.</p>
<h3>Libraries can return anything</h3>
<p>In our above example, we return a table containing the functions we want to expose. However, it's worth pointing out
that you can return ''anything'' from your library - a table, a function or even just a string! <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> treats them
all the same, and just returns whatever your library provides.</p>
<h3>Module resolution and the package path</h3>
<p>In the above examples, we defined our library in a file, and <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> read from it. While this is what you'll do most
of the time, it is possible to make <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> look elsewhere for your library, such as downloading from a website or
loading from an in-memory library store.</p>
<p>As a result, the <em>module name</em> you pass to <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> doesn't correspond to a file path. One common mistake is to load
code from a sub-directory using <code>require(&quot;folder/library&quot;)</code> or even <code>require(&quot;folder/library.lua&quot;)</code>, neither of which
will do quite what you expect.</p>
<p>When loading libraries (also referred to as <em>modules</em>) from files, <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> searches along the <a href="https://www.lua.org/manual/5.1/manual.html#pdf-package.path" class="reference"><em>module
path</em></a>. By default, this looks something like:</p>
<ul>
<li><code>?.lua</code></li>
<li><code>?/init.lua</code></li>
<li><code>/rom/modules/main/?.lua</code></li>
<li>etc...</li>
</ul>
<p>When you call <code>require(&quot;my_library&quot;)</code>, <a href="https://www.lua.org/manual/5.1/manual.html#pdf-require" class="reference"><code>require</code></a> replaces the <code>?</code> in each element of the path with your module name, and
checks if the file exists. In this case, we'd look for <code>my_library.lua</code>, <code>my_library/init.lua</code>,
<code>/rom/modules/main/my_library.lua</code> and so on. Note that this works <em>relative to the current program</em>, so if your
program is actually called <code>folder/program</code>, then we'll look for <code>folder/my_library.lua</code>, etc...</p>
<p>One other caveat is loading libraries from sub-directories. For instance, say we have a file
<code>my/fancy/library.lua</code>. This can be loaded by using <code>require(&quot;my.fancy.library&quot;)</code> - the '.'s are replaced with '/'
before we start looking for the library.</p>
<h2>External links</h2>
<p>There are several external resources which go into require in a little more detail:</p>
<ul>
<li>The <a href="http://lua-users.org/wiki/ModulesTutorial">Lua Module tutorial</a> on the Lua wiki.</li>
<li><a href="https://www.lua.org/manual/5.1/manual.html#pdf-require">Lua's manual section on <code>require</code></a>.</li>
</ul>
</section><footer>Last updated on 2023-10-11</footer></div><div id="search-overlay"></div><script src="../main.js?v=f449c6d1" type="text/javascript" defer=""></script></body></html>